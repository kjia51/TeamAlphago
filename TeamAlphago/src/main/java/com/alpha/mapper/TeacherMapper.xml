<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.alpha.mapper.TeacherMapper">

<!-- 콘텐츠  -->
	<!-- 조회  -->
	<select id="getContentList" resultType="com.alpha.vo.ContentVO">
			SELECT *
			FROM content
			ORDER BY c_no DESC
			LIMIT #{amount} OFFSET #{startNo}
	</select>
	
	<!-- 콘텐츠 총 갯수 -->
	<select id="totalCnt" resultType="int">
	select count(*) from content
	</select>	
	
	<!-- c_id로 콘텐츠 상세 내용 가져오기 -->
	<select id="getContentDetail" resultType="com.alpha.vo.ContentVO">
	select * from content where c_no = #{c_no}
	</select>
	
	<!-- 결제 시 구독내역에 인서트 -->
	<insert id="insertPayAction">
   	INSERT INTO subscribe (SUB_NO, SUB_C_NO, T_M_ID, SUB_DATE, SUB_PRICE, SUB_ABLE, SUB_CONNECTION)
	VALUES (#{sub_no}, #{sub_c_no}, #{t_m_id}, #{sub_date}, #{sub_price}, #{sub_able}, #{sub_connection})
   </insert>
	
	<!-- 나의 구독내역 리스트 -->
	<select id="mySubList" resultType="com.alpha.vo.SubscribeVO">
	select s.* , c_name
	from subscribe s, content 
	where s.sub_c_no = content.c_no
    and t_m_id = #{t_m_id}
	</select>
		
	<!-- 취소 시 환불&구독내역에서 삭제 -->
	<delete id="cancelPay">
		delete from subscribe where sub_no=#{sub_no}
	</delete>
	
<!-- 그룹  -->
	<!-- t_m_id로  가져오기 -->
	<select id="getmyGroupList" resultType="com.alpha.vo.GrpVO">
	select * from grp where t_m_id = #{t_m_id}
	</select>
	
	<!-- 그룹 등록  -->
	<insert id="insertGroups">
	INSERT INTO grp (t_m_id, g_name, g_cnt, g_start, g_end) VALUES
    (#{t_m_id}, #{g_name}, #{g_cnt},
    STR_TO_DATE(#{g_start}, '%Y-%m-%d'),
    DATE_ADD(STR_TO_DATE(#{g_start}, '%Y-%m-%d'), INTERVAL 90 DAY));
	</insert>
	
	<!-- 해당 구독 정보 가져오기 / sub_id-->
	<select id="getSubOne"  resultType="com.alpha.vo.SubscribeVO">
	select s.* , c_level, c_no, c_name
	from subscribe s, content 
	where s.sub_c_no = content.c_no
	and sub_no = #{sub_id}
	</select>
	
	<!-- 해당 그룹 정보 가져오기 / sub_id-->
	<select id="getGroupOne"  resultType="com.alpha.vo.GrpVO">
	select * from grp where g_no= #{g_no}
	</select>

</mapper>