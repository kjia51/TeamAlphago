<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.alpha.mapper.ContentMapper">
	<select id="getContentList" resultType="com.alpha.vo.ContentVO">
		select * from content
	</select>

	<insert id="insertContent">
	insert into content(c_no, c_name, c_level, c_able, c_price, c_content)  values 
	(#{c_no},#{c_name},#{c_level},#{c_able},#{c_price},#{c_content} )
	</insert>
	
	<select id="getContentOne" resultType="com.alpha.vo.ContentVO">
		select * from content where c_no=#{c_no}
	</select>
	
	<update id="updateContent">
		update content set c_name=#{c_name}, c_level=#{c_level}, 
		c_able=#{c_able}, c_price=#{c_price}, c_content=#{c_content}
		where c_no=#{c_no}
	</update>
	
	<delete id="deleteContent">
		delete from content where c_no=#{c_no}
	</delete>
	
	<select id="salesContent" resultType="com.alpha.vo.SalesVO">
    	    select sub_c_no, count(*) s_count, ROUND(AVG(sub_price),0) s_sales, c_name  from subscribe s
			left join (select * from content) c on sub_c_no = c_no
		    group by sub_c_no
	</select>
	
	<select id="salesDate" resultType="com.alpha.vo.SalesVO">
    	select DATE_FORMAT(sub_date,'%Y-%m-%d') s_date, COUNT(*) s_count, ROUND(AVG(sub_price),0) s_sales from subscribe group by DATE_FORMAT(sub_date,'%Y-%m-%d') 
	</select>
	
	<insert id="addCart">
      insert into cart(cr_no, cr_m_no, cr_c_no, cnt)  values (#{cr_no}, #{cr_m_no}, #{cr_c_no},#{cnt}) 
	</insert>
	
	<select id="getCartList" resultType="com.alpha.vo.CartVO">
		select * from cart WHERE cr_c_no=#{cr_c_no}
	</select>
	
	<select id="selectCart" resultType="com.alpha.vo.CartVO">
	     select c_no, c_name, c_level, cnt from content a left outer join (select * from cart) b on a.c_no = b.cr_c_no
	</select>
	
	<select id="addCartListCnt" resultType="int">
	    SELECT count(*) FROM cart WHERE (cr_m_no, cr_c_no) IN (SELECT cr_m_no, cr_c_no FROM cart where cr_m_no=#{cr_m_no} and cr_c_no=#{cr_c_no} and cnt=#{cnt})
	</select>
	
	

</mapper>